############################
# Zsh for macOS – Git friendly (no external plugins)
############################

# ---- Oh My Zsh base path ----
export ZSH="$HOME/.oh-my-zsh"

# ---- Theme ----
# Using "agnoster" for Git branch display without external dependencies
ZSH_THEME="agnoster"

# ---- Oh My Zsh built-in plugins ----
# git → git shortcuts (gst, gco, etc.)
# gitfast → faster git completions
# git-extras → additional git commands
# colored-man-pages → colorize man pages
# macos → macOS-specific helper commands
# brew → Homebrew completions (works if brew exists)
# z → quick directory jumping based on usage history
plugins=(
  git
  gitfast
  git-extras
  colored-man-pages
  macos
  brew
  z
)

# Load Oh My Zsh
source $ZSH/oh-my-zsh.sh

# ---- History settings ----
HISTFILE=~/.zsh_history
HISTSIZE=50000
SAVEHIST=50000
setopt HIST_IGNORE_DUPS       # Ignore duplicate commands
setopt HIST_IGNORE_SPACE      # Ignore commands starting with a space
setopt SHARE_HISTORY          # Share history between terminal sessions

# ---- Zsh behavior ----
setopt AUTO_CD                # Type directory name to cd into it
setopt CORRECT                # Autocorrect minor typos
setopt COMPLETE_IN_WORD       # Tab completion inside words
autoload -Uz compinit && compinit -C  # Cached autocompletion

bindkey -e                    # Emacs key bindings (bash-like)

# ---- PATH adjustments ----
if [ -d "/opt/homebrew/bin" ]; then
  export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"
fi
if [ -d "/usr/local/bin" ]; then
  export PATH="/usr/local/bin:/usr/local/sbin:$PATH"
fi

# ---- Colors for ls/grep ----
export CLICOLOR=1
export LSCOLORS=GxFxCxDxBxegedabagaced
export GREP_OPTIONS='--color=auto' 2>/dev/null || true

# ---- Git defaults ----
export GIT_PAGER='less -+F -R'
export GIT_MERGE_AUTOEDIT=no
git config --global color.ui auto >/dev/null 2>&1

# ---- Prompt fallback (if theme doesn't handle git) ----
if [ "$ZSH_THEME" != "agnoster" ]; then
  PROMPT='%F{cyan}%n%f@%F{magenta}%m%f %F{yellow}%1~%f $(git_prompt_info)
$ '
  ZSH_THEME_GIT_PROMPT_PREFIX="%F{green}‹"
  ZSH_THEME_GIT_PROMPT_SUFFIX="›%f"
  ZSH_THEME_GIT_PROMPT_DIRTY=" %F{red}*%f"
  ZSH_THEME_GIT_PROMPT_CLEAN=""
fi

# ---- Bash-style completion ----
autoload -U bashcompinit && bashcompinit

# ---- Safety settings ----
set -o pipefail   # Fail if any command in a pipeline fails
set -o noclobber  # Prevent overwriting files with >

# ---- Default editor ----
export EDITOR="vim"